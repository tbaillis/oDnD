<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unified Character Interface Test</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #1a1a2e;
            color: #0080FF;
            font-family: 'Courier New', monospace;
        }
        
        .test-controls {
            background: linear-gradient(135deg, #0a0a1a, #1a1a2e);
            border: 2px solid #0080FF;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .test-controls h1 {
            color: #FFFF00;
            margin: 0 0 20px 0;
        }
        
        .test-button {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            margin: 5px;
        }
        
        .test-button:hover {
            background: linear-gradient(135deg, #7c3aed, #6d28d9);
        }
        
        .output {
            background: #0a0a1a;
            border: 2px solid #0080FF;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="test-controls">
        <h1>Unified Character Interface Test</h1>
        <p>Test the unified character creation and editing interface with tab-based navigation.</p>
        
        <button class="test-button" onclick="testCreateMode()">Test Creation Mode</button>
        <button class="test-button" onclick="testEditMode()">Test Edit Mode</button>
        <button class="test-button" onclick="testCharacterManager()">Test Character Manager</button>
        <button class="test-button" onclick="clearOutput()">Clear Output</button>
    </div>

    <div class="output" id="output"></div>

    <script type="module">
        import { UnifiedCharacterInterface } from './src/ui/unifiedCharacterInterface.js'
        import { characterManager, convertCreationDataToCharacter } from './src/game/characterManager.js'

        let unifiedInterface
        let testCharacter

        // Initialize the interface
        function initInterface() {
            unifiedInterface = new UnifiedCharacterInterface({
                onComplete: (character) => {
                    log('Character creation/edit completed:', character)
                    log('Character name:', character.name)
                    log('Character race:', character.race)
                    log('Character class:', character.classes[0]?.class || 'unknown')
                    log('Character level:', character.classes[0]?.level || 1)
                    log('Hit points:', character.hitPoints)
                    log('Ability scores:', character.abilityScores)
                },
                onCancel: () => {
                    log('Character creation/edit cancelled')
                }
            })
        }

        // Test creation mode
        window.testCreateMode = function() {
            log('=== Testing Creation Mode ===')
            if (!unifiedInterface) {
                initInterface()
            }
            unifiedInterface.showForCreation()
            log('Opened unified interface in creation mode')
        }

        // Test edit mode
        window.testEditMode = function() {
            log('=== Testing Edit Mode ===')
            if (!unifiedInterface) {
                initInterface()
            }

            // Create a sample character to edit
            testCharacter = {
                name: 'Test Warrior',
                race: 'Human',
                classes: [{ class: 'fighter', level: 3, hitPointsRolled: 28, skillPointsSpent: {}, featsGained: [] }],
                abilityScores: { STR: 16, DEX: 14, CON: 15, INT: 12, WIS: 13, CHA: 10 },
                hitPoints: { current: 25, max: 28, temporary: 0 },
                armorClass: { base: 10, total: 16, touch: 12, flatFooted: 14 },
                savingThrows: { fortitude: 4, reflex: 2, will: 1 },
                skills: {},
                feats: ['Combat Reflexes', 'Power Attack'],
                equipment: { weapons: [], items: [] }
            }

            unifiedInterface.showForEdit(testCharacter, 'test-character-id')
            log('Opened unified interface in edit mode for character:', testCharacter.name)
        }

        // Test character manager
        window.testCharacterManager = function() {
            log('=== Testing Character Manager ===')
            
            // Test character creation data
            const creationData = {
                name: 'Test Mage',
                race: 'elf',
                characterClass: 'wizard',
                abilityGenerationMethod: 'pointBuy',
                abilities: {
                    strength: 8,
                    dexterity: 14,
                    constitution: 12,
                    intelligence: 16,
                    wisdom: 13,
                    charisma: 10
                },
                hitPoints: 6,
                skills: [],
                feats: ['Spell Focus'],
                equipment: []
            }
            
            log('Created test character data:', creationData)
            
            // Convert to unified character format
            try {
                const character = convertCreationDataToCharacter(creationData)
                log('Converted to unified character format:', character)
                
                // Store character
                const storedId = characterManager.storeCharacter(character)
                log('Stored character with ID:', storedId)
                
                // Retrieve all characters
                const allCharacters = characterManager.getAllCharacters()
                log('All stored characters:', allCharacters)
                
                // Test conversion back to creation data
                const backToCreationData = characterManager.convertCharacterToCreationData(character)
                log('Converted back to creation data:', backToCreationData)
                
            } catch (error) {
                log('Error in character manager test:', error.message)
            }
        }

        // Clear output
        window.clearOutput = function() {
            document.getElementById('output').textContent = ''
        }

        // Logging function
        function log(...args) {
            const output = document.getElementById('output')
            const timestamp = new Date().toLocaleTimeString()
            const message = args.map(arg => 
                typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
            ).join(' ')
            output.textContent += `[${timestamp}] ${message}\n`
            output.scrollTop = output.scrollHeight
        }

        // Initialize
        log('Unified Character Interface Test loaded')
        log('Click buttons above to test different features')
    </script>
</body>
</html>
